<?xml version="1.0" ?>
<sfc zoom="1.2261903" canvas="11 15" execution-mode="Callable" version="7.9.0 (b2016101208)" timestamp="Sun Mar 26 10:29:08 CDT 2017" hot-editable="false" persist-state="false">
	<step id="2f208c4c-6b43-11d9-a9ad-00022dc3c8fd" location="2 1" name="S88Begin_13770" factory-id="begin-step">		<associated-data>{}</associated-data>
	</step>
	<step id="0c9c147c-8c12-11d9-b116-00065b88c6c2" location="2 2" name="DisableCommands" factory-id="com.ils.enableDisableStep" breakpoint="true"><description></description><breakpoint>true</breakpoint><enablePause>false</enablePause><enableStart>false</enableStart><enableCancel>false</enableCancel><enableResume>false</enableResume><enableReset>false</enableReset><name>DisableCommands</name><id>0c9c147c-8c12-11d9-b116-00065b88c6c2</id>		<associated-data>{}</associated-data>
	</step>
	<step id="8dd3fa46-6e82-11d9-a86e-006008c66680" location="1 3" name="CopyData" factory-id="action-step">
		<start-script># Copyright 2016 ExxonMobil Corporation. All rights reserved.

'''
    Copy data from the old object into the individual the various bits of data that are outside the domain of the S88 unit procedure and 
    stuff them into the global recipe data.  Specifically, this data is rla3-current-grade, oil-grade-flag, and oil-time-to-closed, 
    irg-time-to-closed, and cast-time-to-closed from the complex object CATOUT-RECIPE_STATUS. 
'''
import system
from ils.sfc.common.constants import GLOBAL_SCOPE,OPERATION_SCOPE

from S88State import abort
from ils.sfc.gateway.api import getChartLogger

def onStart(chart,block):
	log = getChartLogger(chart)
	oilFlagTruth = False
	log.tracef("In %s...",block.get("name",""))

	#TODO Figure out what CATOUR-RECIPE-STATUS is! 
	system.tag.write("SFC IO/CatOut General/S88-RX-RCP-OIL-MAX-TIME-TO-CLOSED",system.tag.read("[]Site/CATOUT-RECIPE-STATUS/oilTimeToCLosed").getValue())
	system.tag.write("SFC IO/CatOut General/S88-RX-RCP-IRG-MAX-TIME-TO-CLOSED",system.tag.read("[]Site/CATOUT-RECIPE-STATUS/irgTimeToClosed").getValue())
	system.tag.write("SFC IO/CatOut General/S88-RCP-CAST-MAX-TIME-TO-CLOSED",system.tag.read("[]Site/CATOUT-RECIPE-STATUS/castTimeToCLosed").getValue())

	unitProcedure = UnitProcedure.get(block)
	try:
		grade = round(system.tag.read("[]DiagnosticToolkit/CSTR/RLA3-Current-Grade/value").getValue())
		oilFlag = round(system.tag.read("SFC IO/Cold Stick Permissives/S88-RX-RCP-OIL-FLAG").getValue())
		rxConfig = round(system.tag.read("[]DiagnosticToolkit/CSTR/RX-CONFIGURATION/value").getValue())
	except:
		finalDiagnosis.postError(chart,block,"Data collection for the oil flag or the grade number has failed and catout sequence has been terminated. Contact an AE and/or catout manually.")
		system.util.invokeAsynchronous(S88State.abort(unitProcedure))		

	if oilFlag == 0:
		oilFlagTruth = False
	else:
		oilFlagTruth = True

	s88Set(chart,block,"grade.value",grade,GLOBAL_SCOPE)
	s88Set(chart,block,"oil-flag.value",oilFlagTruth,GLOBAL_SCOPE)
	s88Set(chart,block,"oil-out-wait.value",system.tag.read("SFC IO/CatOut General/S88-RX-RCP-OIL-MAX-TIME-TO-CLOSED").getValue(),OPERATION_SCOPE)
	s88Set(chart,block,"irganox-out-wait.value",system.tag.read("SFC IO/CatOut General/S88-RX-RCP-IRG-MAX-TIME-TO-CLOSED").getValue(),OPERATION_SCOPE)
	s88Set(chart,block,"calcium-out-wait.value",system.tag.read("SFC IO/CatOut General/S88-RCP-CAST-MAX-TIME-TO-CLOSED").getValue(),OPERATION_SCOPE)
	
	if rxConfig &lt; 3:
		s88Set(chart,block,"r2-c2-flow-sp.download",False,OPERATION_SCOPE)
	else:
		s88Set(chart,block,"r2-c2-flow-sp.download",True,OPERATION_SCOPE)

	# Send the CAT-OUT request to vistalon-unit-procedure object. Use a write output to send to PhD object. 
	s88Set(chart,block,"rla3-output-to-phd-text.val","CAT-OUT requested for grade %s."%(str(grade)),GLOBAL_SCOPE)
	# call write-datum(rla3-outputs-to-phd, "CAT-OUT requested for grade [GRADE]."); 
	
	# Record the current time as the catout time! 
	s88Set(chart,block,"catout-time.value",Date().toString(),GLOBAL_SCOPE)
	log.tracef("%s has completed!",block.get("name",""))</start-script>
		<associated-data>{}</associated-data>
	</step>
	<step id="63a6770c-91a2-11d9-b116-00065b88c6c2" location="2 4" name="WriteOutputs" factory-id="com.ils.writeOutputStep"><globalErrorCountKey>total-download-errors.value</globalErrorCountKey><timerKey>unit-procedure-start-time</timerKey><timerLocation>global</timerLocation><recipeLocation>global</recipeLocation><timerSet>false</timerSet><description></description><globalErrorCountLocation>operation</globalErrorCountLocation><verbose>true</verbose><name>WriteOutputs</name><writeOutputConfig>{"rows":[{"key":"rla3-output-to-phd-text","confirmWrite":true}]}</writeOutputConfig><id>63a6770c-91a2-11d9-b116-00065b88c6c2</id>		<associated-data>{}</associated-data>
	</step>
	<step id="e10c4250-6b61-11d9-a9ad-00022dc3c8fd" location="2 6" name="StartMessage" factory-id="com.ils.queueMessageStep"><name>StartMessage</name><description></description><id>e10c4250-6b61-11d9-a9ad-00022dc3c8fd</id><message>The CATOUT was started for grade [grade.val].</message><priority>Info</priority>		<associated-data>{}</associated-data>
	</step>
	<step id="741cce46-9a24-11d9-b116-00065b88c6c2" location="6 3" name="C6andRxFlows" factory-id="enclosing-step" chart-path="VistalonUnitProcedure/PolymerizeEpdm/Catout/ImplementCo/StartCatout/MangeC6AndRxFlows" execution-mode="RunUntilCompletion">		<associated-data>{}</associated-data>
	</step>
	<step id="b61ed641-9016-11d9-b116-00065b88c6c2" location="6 4" name="ManagingCatalystMessage" factory-id="com.ils.controlPanelMessageStep"><description></description><timeoutUnit>SEC</timeoutUnit><message>Managing the catalyst, sidestreams, and E205 valve.</message><priority>Info</priority><postToQueue>false</postToQueue><timeout>10.0</timeout><ackRequired>false</ackRequired><name>ManagingCatalystMessage</name><id>b61ed641-9016-11d9-b116-00065b88c6c2</id>		<associated-data>{}</associated-data>
	</step>
	<step id="bd2175d0-89ce-11d9-a9b8-000bcd538076" location="6 5" name="CatRampDown" factory-id="enclosing-step" chart-path="VistalonUnitProcedure/PolymerizeEpdm/Catout/ImplementCo/StartCatout/ManageCatRampDown/ManageCatRampDown" execution-mode="RunUntilCompletion">		<associated-data>{}</associated-data>
	</step>
	<step id="e24a9f50-6b65-11d9-a9ad-00022dc3c8fd" location="6 6" name="Delay2Minutes" factory-id="com.ils.timedDelayStep"><postNotification>false</postNotification><recipeLocation>superior</recipeLocation><tagPath></tagPath><description></description><scale>1.0</scale><windowTitle></windowTitle><message></message><buttonLabel></buttonLabel><delay>2.0</delay><name>Delay2Minutes</name><callback>G2</callback><id>e24a9f50-6b65-11d9-a9ad-00022dc3c8fd</id><position>center</position><strategy>static</strategy><key>g2</key><delayUnit>MIN</delayUnit>		<associated-data>{}</associated-data>
	</step>
	<step id="3928877c-8071-11d9-a871-006008c66680" location="1 9" name="SeedData" factory-id="enclosing-step" chart-path="VistalonUnitProcedure/PolymerizeEpdm/Catout/ImplementCo/StartCatout/SeedDataTask" execution-mode="RunUntilCompletion">		<associated-data>{}</associated-data>
	</step>
	<step id="7a0b8a2c-806d-11d9-a871-006008c66680" location="3 9" name="NotSeededMessage" factory-id="com.ils.queueMessageStep"><name>NotSeededMessage</name><description></description><id>7a0b8a2c-806d-11d9-a871-006008c66680</id><message>Rate change objects NOT seeded with current data at OC request.</message><priority>Info</priority>		<associated-data>{}</associated-data>
	</step>
	<step id="5fe95b2f-b70d-11d9-b117-00065b88c6c2" location="6 8" name="E205Output" factory-id="enclosing-step" chart-path="VistalonUnitProcedure/PolymerizeEpdm/Catout/ImplementCo/StartCatout/ManageE205Output" execution-mode="RunUntilCompletion">		<associated-data>{}</associated-data>
	</step>
	<step id="64fd60d0-6b66-11d9-a9ad-00022dc3c8fd" location="6 9" name="Additives" factory-id="enclosing-step" chart-path="VistalonUnitProcedure/PolymerizeEpdm/Catout/ImplementCo/StartCatout/ManageAdditives/ManageAdditives" execution-mode="RunUntilCompletion">		<associated-data>{}</associated-data>
	</step>
	<step id="eb2791ea-6e1d-11d9-a86e-006008c66680" location="1 11" name="C3ClampData" factory-id="enclosing-step" chart-path="VistalonUnitProcedure/PolymerizeEpdm/Catout/ImplementCo/StartCatout/C3ClampDataCollection" execution-mode="RunUntilCompletion">		<associated-data>{}</associated-data>
	</step>
	<step id="0c9c1482-8c12-11d9-b116-00065b88c6c2" location="6 10" name="EnableCommands" factory-id="com.ils.enableDisableStep"><enableStart>true</enableStart><enableCancel>true</enableCancel><enableResume>true</enableResume><enableReset>true</enableReset><name>EnableCommands</name><description></description><id>0c9c1482-8c12-11d9-b116-00065b88c6c2</id><enablePause>true</enablePause>		<associated-data>{}</associated-data>
	</step>
	<step id="80fd5260-6b64-11d9-a9ad-00022dc3c8fd" location="1 12" name="C3Message" factory-id="com.ils.queueMessageStep"><name>C3Message</name><description></description><id>80fd5260-6b64-11d9-a9ad-00022dc3c8fd</id><message>The C3 SPCL's to be used are R1 = [r1-c3-flow-spcl.val] and R2 = [r2-c3-flow-spcl.val].</message><priority>Info</priority>		<associated-data>{}</associated-data>
	</step>
	<step id="2f208c47-6b43-11d9-a9ad-00022dc3c8fd" location="6 11" name="S88End_13769" factory-id="end-step">		<associated-data>{}</associated-data>
	</step>
	<transition id="ca2b74e8-2cdf-4fc4-a377-6ea64bace7c3" location="2 5">{previous.workDone}</transition>
	<transition id="66060230-6bcb-11d9-a9ad-00022dc3c8fd" location="1 8" timeout-enabled="true" timeout-delay="1000" timeout-flag="S88-CONDITIONAL-TRANSITION-XXX-13764">{operation.catout-mode.value} = "Proceed-With-Capture"</transition>
	<transition id="7a6cf910-6bcb-11d9-a9ad-00022dc3c8fd" location="3 8" timeout-enabled="true" timeout-delay="1000" timeout-flag="S88-CONDITIONAL-TRANSITION-XXX-13763">{operation.catout-mode.value} != "Proceed-With-Capture"</transition>
	<transition id="1c04701e-603c-4eb1-967b-013709864d1f" location="6 7">{previous.workDone}</transition>
	<note id="9bcf9843-c478-4bd0-97ee-19c1ea12b349" location="3 3" size="2 1" note-background="color(255,0,0,255)">Needs work</note>
	<note id="d5f8ecbf-9155-4fa3-b5b9-39eb6dbc5d8d" location="8 1" size="2 1">Manually Vetted
11/8/16</note>
	<link id="7a548738-7751-441a-ab66-8f664cc977dd" location="2 3"><up/><down/></link>
	<link id="bb215b46-eee5-48ba-b9e7-1cb211042aa3" location="5 2"><up/><down/><right/></link>
	<link id="81fc6771-66cb-4089-83ba-76d35b4f1b35" location="5 3"><up/><down/></link>
	<link id="12226062-784a-4cea-a4b6-c735bccab124" location="6 2"><left/><down/><right/></link>
	<link id="7dacc0ed-5b54-41ba-8b41-9600056b621e" location="5 4"><up/><down/></link>
	<link id="d44c2a16-7759-41f9-9d3c-da9f2537e660" location="1 7"><down/><right/></link>
	<link id="d5833c78-daec-4405-ab01-74c5a2a98718" location="5 5"><up/><down/></link>
	<link id="d37e86c8-745d-47eb-aa3d-e96c41df4f0a" location="2 7"><up/><left/><right/></link>
	<link id="98e6f26d-4791-4474-bcd6-5a2e070df370" location="3 7"><left/><down/></link>
	<link id="87c4e27b-a506-450b-8843-ac227c0756ff" location="5 6"><up/><down/></link>
	<link id="b254b113-9aed-4051-bde1-f1b22eb9c541" location="5 7"><up/><down/></link>
	<link id="af704ee5-ab4d-4ec1-9422-f407b039999b" location="5 8"><up/><down/></link>
	<link id="a998b1dd-5fea-4127-bc48-d99d7cae8606" location="1 10"><up/><down/><right/></link>
	<link id="4b4f7118-0ab5-4af7-914f-b461f50a3560" location="2 10"><left/><right/></link>
	<link id="4bb33264-c4af-4f22-8fea-ea6ae01e2ca9" location="5 9"><up/><down/></link>
	<link id="3c290bf3-a62e-4164-b843-be190f701e6a" location="3 10"><up/><left/><down/></link>
	<link id="d20552c9-b552-4600-b76a-916d553a3733" location="5 10"><up/><down/></link>
	<link id="539ff86a-8816-453f-b107-5049893a06d6" location="5 11"><up/><down/></link>
	<link id="0e4b2df8-861c-4bd5-96dd-5e945f683d48" location="5 12"><up/><down/></link>
	<link id="40405851-bb0d-4a23-9b43-ec1504e35a70" location="1 13"><up/><down/><right/></link>
	<link id="8aa83baa-0b8d-48d7-b7d1-3c7e2bb6b2bc" location="2 13"><left/><right/></link>
	<link id="5a8fc171-0c2d-4137-9272-506ca4bc63e2" location="3 13"><left/><right/></link>
	<link id="7a8154f3-5004-42af-abbc-3fcf11583924" location="4 13"><left/><right/></link>
	<link id="822b2fe0-2372-43d4-804c-498ca50edefb" location="5 13"><up/><left/><right/></link>

</sfc>
