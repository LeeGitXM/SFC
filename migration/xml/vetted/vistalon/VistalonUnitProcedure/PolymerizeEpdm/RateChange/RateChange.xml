<?xml version="1.0" ?>
<sfc zoom="1.0666667" canvas="12 18" execution-mode="Callable" version="7.9.0 (b2016101208)" timestamp="Mon Apr 17 12:39:35 CDT 2017" hot-editable="false" persist-state="true">
	<step id="e8350bbd-7958-11d9-a870-006008c66680" location="4 0" name="Begin" factory-id="begin-step">		<associated-data>{}</associated-data>
	</step>
	<step id="190eef0a-d4f7-11e1-b661-00142223a71b" location="4 1" name="Rate Change Queue" factory-id="com.ils.clearQueueStep" breakpoint="true"><name>Rate Change Queue</name><description></description><id>190eef0a-d4f7-11e1-b661-00142223a71b</id><breakpoint>true</breakpoint>		<associated-data>{}</associated-data>
	</step>
	<step id="e66b0158-798c-11d9-a870-006008c66680" location="2 6" name="ValidateState" factory-id="action-step">
		<start-script># Copyright 2016 ExxonMobil Corporation. All rights reserved.

'''
 . 
'''

import system
from ils.sfc.common.constants import ERROR,LOCAL_SCOPE
from com.ils.queue import post
from ils.sfc.gateway.api import getChartLogger
from ils.sfc.gateway import api
def onStart(chart,block):
	log = system.util.getLogger(getChartLogger(chart))
	log.tracef("In %s with %s, a %s. . .",chart.get("name",""),block.get("name",""),"step")

	grade = round(system.tag.read("[]DiagnosticToolkit/CSTR/RLA3-Current-Grade/value").getValue())

	#  wrong button used - alert OC 
	if grade != button.get("grade",""):
		post.messageToQueue(chart,block,"Current grade is %s. Rate change data is for %s. Use the rocket on the Operator Console for a cold stick."%(str(grade),button.get("grade","")),ERROR,block)
		api.s88SetData(chart,block,"ok-to-proceed.val","false",LOCAL_SCOPE)
	else:
		api.s88SetData(chart,block,"ok-to-proceed.val","true",LOCAL_SCOPE)

	log.tracef("%s has completed!",block.get("name",""))
</start-script>
		<associated-data>{}</associated-data>
	</step>
	<step id="89fcb8e9-91b0-11d9-b116-00065b88c6c2" location="0 9" name="WrongGrade" factory-id="com.ils.abortStep"><ackRequired>false</ackRequired><name>WrongGrade</name><description>Since the grade for rate change data is not for the current grade, abort the rate change.</description><id>89fcb8e9-91b0-11d9-b116-00065b88c6c2</id><message></message>		<associated-data>{}</associated-data>
	</step>
	<step id="d9426d74-7958-11d9-a870-006008c66680" location="5 10" name="RxConfigCheckMsg" factory-id="com.ils.controlPanelMessageStep"><description></description><timeoutUnit>SEC</timeoutUnit><message>Determining the reactor configuration for Rate Change. Please be patient.</message><priority>Info</priority><postToQueue>false</postToQueue><timeout>10.0</timeout><ackRequired>false</ackRequired><name>RxConfigCheckMsg</name><id>d9426d74-7958-11d9-a870-006008c66680</id>		<associated-data>{}</associated-data>
	</step>
	<step id="7e3ef208-79f8-11d9-a870-006008c66680" location="2 13" name="SingleRx" factory-id="enclosing-step" chart-path="VistalonUnitProcedure/PolymerizeEpdm/RateChange/SingleRxRateChange/SingleRxRateChange" execution-mode="RunUntilCompletion">		<associated-data>{"SELECTED-BUTTON":{"lowLimit":null,"advice":"","description":"","label":"","units":"","type":"Text","help":"","dataId":"13f5b5b5-d533-4078-be3b-630f7805d887","valueType":"string","highLimit":null,"category":"Simple Constant","class":"Value","value":"CANCEL","key":"SELECTED-BUTTON"}}</associated-data>
	</step>
	<step id="0729ffd8-8113-11d9-a871-006008c66680" location="4 13" name="SeriesRx" factory-id="enclosing-step" chart-path="VistalonUnitProcedure/PolymerizeEpdm/RateChange/SeriesRxRateChange/SeriesRxRateChange" execution-mode="RunUntilCompletion">		<associated-data>{"SELECTED-BUTTON":{"lowLimit":null,"advice":"","description":"","label":"","units":"","type":"Text","help":"","dataId":"ee3fd80e-e763-466c-93d9-a3ca2180ae6c","valueType":"string","highLimit":null,"category":"Simple Constant","class":"Value","value":"CALCULATE","key":"SELECTED-BUTTON"}}</associated-data>
	</step>
	<step id="1ccc9344-81c4-11d9-a871-006008c66680" location="6 13" name="SplitRx" factory-id="enclosing-step" chart-path="VistalonUnitProcedure/PolymerizeEpdm/RateChange/SplitRxRateChange/SplitRxRateChange" execution-mode="RunUntilCompletion">		<associated-data>{"SELECTED-BUTTON":{"lowLimit":null,"advice":"","description":"","label":"","units":"","type":"Text","help":"","dataId":"531874c7-52c2-4e0f-8f9e-7e9f4ecccbce","valueType":"string","highLimit":null,"category":"Simple Constant","class":"Value","value":"CALCULATE","key":"SELECTED-BUTTON"}}</associated-data>
	</step>
	<step id="155b63a8-81e5-11d9-a871-006008c66680" location="8 13" name="CRx" factory-id="enclosing-step" chart-path="VistalonUnitProcedure/PolymerizeEpdm/RateChange/CRxRateChange/CRxRateChange" execution-mode="RunUntilCompletion">		<associated-data>{"SELECTED-BUTTON":{"lowLimit":null,"advice":"","description":"","label":"","units":"","type":"Text","help":"","dataId":"32566bf4-3489-4d75-ad95-6fb16121a45b","valueType":"string","highLimit":null,"category":"Simple Constant","class":"Value","value":"CALCULATE","key":"SELECTED-BUTTON"}}</associated-data>
	</step>
	<step id="e8350bb8-7958-11d9-a870-006008c66680" location="0 16" name="End" factory-id="end-step">		<associated-data>{}</associated-data>
	</step>
	<transition id="434073c3-cbb4-11d9-b117-00065b88c6c2" location="3 3" timeout-enabled="true" timeout-delay="30000" timeout-flag="Cat Is Out-False">{tag.Site/CRX/CAT-AND-C2-IS-IN} != "TRUE"</transition>
	<transition id="434073d8-cbb4-11d9-b117-00065b88c6c2" location="2 5" timeout-enabled="true" timeout-delay="360000000" timeout-flag="CS Rate Change-False">{global.review-data-button.value} != "Calc-New-Rate"</transition>
	<transition id="434073de-cbb4-11d9-b117-00065b88c6c2" location="5 3" timeout-enabled="true" timeout-delay="30000" timeout-flag="Cat Is Out-True">{tag.Site/CRX/CAT-AND-C2-IS-IN} = "TRUE"</transition>
	<transition id="434073d2-cbb4-11d9-b117-00065b88c6c2" location="4 5" timeout-enabled="true" timeout-delay="360000000" timeout-flag="CS Rate Change-True">{global.review-data-button.value} = "Calc-New-Rate"</transition>
	<transition id="0b80d544-798d-11d9-a870-006008c66680" location="0 8" timeout-enabled="true" timeout-delay="30000" timeout-flag="Right Grade-False">!{previous.ok-to-proceed.value}</transition>
	<transition id="7e6ae9d9-7991-11d9-a870-006008c66680" location="3 8" timeout-enabled="true" timeout-delay="30000" timeout-flag="RightGrade-True">{previous.ok-to-proceed.value}</transition>
	<transition id="0f378364-7987-11d9-a870-006008c66680" location="2 12" timeout-enabled="true" timeout-delay="30000" timeout-flag="Single Rx-True">{tag.Recipe/Local/SINGLE-RX-GRADE}</transition>
	<transition id="0f37836a-7987-11d9-a870-006008c66680" location="4 12" timeout-enabled="true" timeout-delay="30000" timeout-flag="Series Rx-True">{tag.Recipe/Local/SERIES-RX-GRADE}</transition>
	<transition id="0f378370-7987-11d9-a870-006008c66680" location="6 12" timeout-enabled="true" timeout-delay="30000" timeout-flag="Split Rx-True">{tag.Site/CSTR/SPLIT-FEED_GRADE}</transition>
	<transition id="0f378376-7987-11d9-a870-006008c66680" location="8 12" timeout-enabled="true" timeout-delay="30000" timeout-flag="C-Rx-True">{tag.Recipe/Local/C-RX-GRADE}</transition>
	<link id="0c3779e4-7218-4074-8aea-1cf58cafba59" location="3 2"><down/><right/></link>
	<link id="4ca500e1-50d1-4b5a-bfed-590000889824" location="4 2"><up/><left/><right/></link>
	<link id="366173c1-12da-4b3e-9d65-fbb4986f4052" location="2 4"><down/><right/></link>
	<link id="3f5b50c5-c02d-4c3c-97fb-fb6b8b812b1a" location="3 4"><up/><left/><right/></link>
	<link id="81047919-b4fb-414a-8507-3e2aa24dce04" location="5 2"><left/><down/></link>
	<link id="87129229-91d4-481f-9b98-b6e4c41d47f0" location="4 4"><left/><down/></link>
	<link id="313aba6c-4cb4-48d6-bec3-7a5d9442069f" location="5 4"><up/><down/></link>
	<link id="0bcf0f50-8002-4891-8a57-b8cc6b34fce9" location="0 7"><down/><right/></link>
	<link id="84d42575-cb93-4008-a5c3-9359af1d7336" location="1 7"><left/><right/></link>
	<link id="002df09b-ee86-41b8-ae65-f61b8919a6d1" location="5 5"><up/><down/></link>
	<link id="7c2bfb4b-6977-4370-8d41-e6c75c1c59a4" location="4 6"><up/><down/><right/></link>
	<link id="8da3a430-100a-45f4-883a-029a71a776ae" location="2 7"><up/><left/><right/></link>
	<link id="e590e45e-53ae-4711-aa15-d5121d27f8c9" location="3 7"><left/><down/></link>
	<link id="3be03e61-1598-4278-9a1e-d014b4398da9" location="5 6"><up/><left/><down/></link>
	<link id="84bec641-8e1a-4dce-a7e1-94e892be0891" location="5 7"><up/><down/></link>
	<link id="5bdea603-297c-4fb1-a9e0-aa00b2b97b55" location="5 8"><up/><down/></link>
	<link id="9568eb17-28ee-4eeb-9604-80932f00a358" location="3 9"><up/><down/><right/></link>
	<link id="97689010-3a9f-4946-a357-773729fd05b7" location="4 9"><left/><right/></link>
	<link id="1f9ba40a-4948-40f8-9b2b-afb0b2e08300" location="0 10"><up/><down/><right/></link>
	<link id="14734388-e548-415f-a828-832f0454bd82" location="5 9"><up/><left/><down/><right/></link>
	<link id="b1e1bbd1-fdce-428f-9736-32ac411ec8ab" location="0 11"><up/><down/></link>
	<link id="40c1520d-726c-40e5-a933-3afbce98b4bb" location="2 11"><down/><right/></link>
	<link id="1a81bd3e-52d6-4b0f-b175-dd9f24fa22d9" location="3 11"><left/><right/></link>
	<link id="8a38d105-1830-4ca3-bd40-80d926fdc459" location="4 11"><left/><down/><right/></link>
	<link id="a3793a11-e066-4f7e-b0ff-53657b311731" location="0 12"><up/><down/></link>
	<link id="0c0713f8-7b65-46ad-a313-2cd2d1e8393b" location="5 11"><up/><left/><right/></link>
	<link id="e58e1a0b-465a-4f18-b87f-96d66575c959" location="6 11"><left/><down/><right/></link>
	<link id="f5346fef-4fbb-40c7-ab2e-c3f78c8bf64d" location="0 13"><up/><down/></link>
	<link id="348d3b52-ae88-4040-8273-24d266a380e6" location="7 11"><left/><right/></link>
	<link id="e1529540-0892-4736-96da-fe262bf57586" location="8 11"><left/><down/></link>
	<link id="d4c1e614-a71a-40da-8643-b9fd01efcf8a" location="0 14"><up/><down/></link>
	<link id="5c87dfae-7d93-484b-9ba3-2e8df2017c59" location="2 14"><up/><down/></link>
	<link id="22e07ef0-7e63-4191-adbb-860d7610c093" location="4 14"><up/><down/></link>
	<link id="affcffea-a9f8-4ee6-bdf4-fcb8f1f6c56b" location="0 15"><up/><down/><right/></link>
	<link id="8056573c-37a4-4363-9a23-22c7ff747b0e" location="1 15"><left/><right/></link>
	<link id="f02513fc-082d-4e3a-821a-bedabd336daa" location="2 15"><up/><left/><right/></link>
	<link id="f7fe9110-0c0e-4cd8-922d-aed54e25caa0" location="6 14"><up/><down/></link>
	<link id="5c4df442-9be9-4baa-adf2-d8ad97ab8a7e" location="3 15"><left/><right/></link>
	<link id="7e90f993-db05-4285-9f16-1e040c53d114" location="4 15"><up/><left/><right/></link>
	<link id="5db9916a-a760-4d81-9555-13a41b0f8355" location="5 15"><left/><right/></link>
	<link id="99c2178d-752c-4fa8-bdeb-39c370445f8b" location="8 14"><up/><down/></link>
	<link id="5c6cc8b3-b429-4759-9670-3a5f953c7148" location="6 15"><up/><left/><right/></link>
	<link id="93e7e727-7982-4116-96c8-6d59a54fde9a" location="7 15"><left/><right/></link>
	<link id="1fe9cbf8-5c6f-4300-8d26-843394191ba4" location="8 15"><up/><left/><down/></link>

</sfc>
