fs-move-data-new-to-cur(BLOCK: class s88-recipe-entity) = (symbol {complete, stopped, or error} )

{ This procedure is a template for implementing a custom callback.  This procedure template is meant to implement logic that runs very quickly.  If the implementation causes wait states or collect data or prolonged looping, then the template that implements logic that will respond to ABORT, STOP, PAUSE and HOLD commands should be used.  This template does not honor ABORT, STOP, PAUSE, or HOLD commands that arrive during its execution. }

RE-CALC-COUNTER: integer;
STATUS: symbol;
BASE-UPDATE-ALLOWED: truth-value;
P: class ph-procedure-or-method = this procedure;
DEBUG-MODE: truth-value = false; 

begin
	if the debug-mode of P or the debug-mode of BLOCK then DEBUG-MODE = true;

	if DEBUG-MODE then post "In [the name of P] with [the label of BLOCK], a [the class of BLOCK]. . .";

	conclude that the state of BLOCK = s88-running-state;

	STATUS, re-calc-counter = call s88-get-data (BLOCK, "re-calc-counter.val", s88-superior-operation ); 
	STATUS, base-update-allowed = call s88-get-data (BLOCK, "base-update-allowed.val", s88-superior-operation );
	if DEBUG-MODE then post "In [the name of P] with re-calc-counter=[re-calc-counter] and base-update-allowed=[base-update-allowed].";

{ Initially the CUR group is used to hold the state of the running unit while the NEW group is used to hold the data for the new grade.  Update the CUR data in the flying-switch operation from the NEW data    }
	if re-calc-counter < 1 then begin
		call s88-update-recipe-data (BLOCK, "NEW", s88-superior-operation, BLOCK, "CUR", s88-superior-operation, true); 
		RE-CALC-COUNTER = RE-CALC-COUNTER + 1;
		BASE-UPDATE-ALLOWED = false;
		call s88-set-data (BLOCK, "re-calc-counter.val", re-calc-counter, s88-superior-operation);
		call s88-set-data (BLOCK, "base-update-allowed.val",  base-update-allowed, s88-superior-operation);
	end;
	if DEBUG-MODE then post "In [the name of P] with re-calc-counter=[re-calc-counter] and base-update-allowed=[base-update-allowed].";
	if DEBUG-MODE then post "[the label of BLOCK] has completed!";

	return s88-complete-state;
end 