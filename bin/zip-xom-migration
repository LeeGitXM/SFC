#!/bin/sh
#
# Save the migration files into a zip for distribution.
# --- actually do the migration. NOTE: migration 
#     database is in the SFC area (shared)
#
#set -x
SVN=${SVN_REPO}/EMChemicals/Release/src
VERS=MIGRATION
TMP=${GIT_REPO}/$VERS
# Cleanup
rm -rf $TMP
cd ${GIT_REPO}
mkdir -p $TMP/
# Share name conversion library with SFC
cd ${GIT_REPO}/sfc/migration
rm -f mdb/*.db
rm -rf tags
cd mdb
./mkdatabase
cd ${GIT_REPO}/sfc/migration
./clear-procs
./copy-procs
./process-vistalon
mkdir -p $TMP/config
mkdir -p $TMP/procs/vistalon
./mktags > $TMP/config/sqltags.xml
cp -a projects/vistalon/* $TMP
cd procs/ignition/vistalon
cp -a * $TMP/procs/vistalon

# Now zip and copy to subversion
cd $TMP
zip -r sfc-migration.zip *
cp sfc-migration.zip $SVN
rm -rf $TMP
